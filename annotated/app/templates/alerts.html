{% extends "base.html" %}  <!-- {% extends "base.html" %} -->
  <!-- blank line -->
{% block title %}Alerts - System Monitor{% endblock %}  <!-- {% block title %}Alerts - System Monitor{% endblock %} -->
  <!-- blank line -->
{% block content %}  <!-- {% block content %} -->
<div class="container">  <!-- <div class="container"> -->
    <header>  <!-- <header> -->
        <h1>Alert Configuration</h1>  <!-- <h1>Alert Configuration</h1> -->
        <button class="btn-primary" onclick="showCreateAlert()">+ New Alert</button>  <!-- <button class="btn-primary" onclick="showCreateAlert()">+ New Alert</button> -->
    </header>  <!-- </header> -->
  <!-- blank line -->
    <div class="card">  <!-- <div class="card"> -->
        <h2>Active Alert Rules</h2>  <!-- <h2>Active Alert Rules</h2> -->
        <table id="alertRulesTable">  <!-- <table id="alertRulesTable"> -->
            <thead>  <!-- <thead> -->
                <tr>  <!-- <tr> -->
                    <th>Name</th>  <!-- <th>Name</th> -->
                    <th>Metric</th>  <!-- <th>Metric</th> -->
                    <th>Threshold</th>  <!-- <th>Threshold</th> -->
                    <th>Server</th>  <!-- <th>Server</th> -->
                    <th>Status</th>  <!-- <th>Status</th> -->
                    <th>Actions</th>  <!-- <th>Actions</th> -->
                </tr>  <!-- </tr> -->
            </thead>  <!-- </thead> -->
            <tbody id="alertRulesBody">  <!-- <tbody id="alertRulesBody"> -->
                <tr>  <!-- <tr> -->
                    <td colspan="6" style="text-align: center;">Loading...</td>  <!-- <td colspan="6" style="text-align: center;">Loading...</td> -->
                </tr>  <!-- </tr> -->
            </tbody>  <!-- </tbody> -->
        </table>  <!-- </table> -->
    </div>  <!-- </div> -->
  <!-- blank line -->
    <div class="card" style="margin-top: 1.5rem;">  <!-- <div class="card" style="margin-top: 1.5rem;"> -->
        <h2>Alert History</h2>  <!-- <h2>Alert History</h2> -->
        <div id="alertHistory">Loading...</div>  <!-- <div id="alertHistory">Loading...</div> -->
    </div>  <!-- </div> -->
</div>  <!-- </div> -->
  <!-- blank line -->
<!-- Create Alert Modal -->  <!-- <!-- Create Alert Modal --> -->
<div id="createAlertModal" class="modal">  <!-- <div id="createAlertModal" class="modal"> -->
    <div class="modal-content">  <!-- <div class="modal-content"> -->
        <span class="close" onclick="closeCreateAlert()">&times;</span>  <!-- <span class="close" onclick="closeCreateAlert()">&times;</span> -->
        <h2>Create Alert Rule</h2>  <!-- <h2>Create Alert Rule</h2> -->
        <form id="createAlertForm" onsubmit="createAlert(event)">  <!-- <form id="createAlertForm" onsubmit="createAlert(event)"> -->
            <div class="form-group">  <!-- <div class="form-group"> -->
                <label>Rule Name</label>  <!-- <label>Rule Name</label> -->
                <input type="text" name="name" required placeholder="e.g., High CPU Usage">  <!-- <input type="text" name="name" required placeholder="e.g., High CPU Usage"> -->
            </div>  <!-- </div> -->
            <div class="form-group">  <!-- <div class="form-group"> -->
                <label>Metric Type</label>  <!-- <label>Metric Type</label> -->
                <select name="metric_type" required>  <!-- <select name="metric_type" required> -->
                    <option value="cpu">CPU Usage (%)</option>  <!-- <option value="cpu">CPU Usage (%)</option> -->
                    <option value="memory">Memory Usage (%)</option>  <!-- <option value="memory">Memory Usage (%)</option> -->
                    <option value="disk">Disk Usage (%)</option>  <!-- <option value="disk">Disk Usage (%)</option> -->
                    <option value="network">Network Traffic (MB/s)</option>  <!-- <option value="network">Network Traffic (MB/s)</option> -->
                </select>  <!-- </select> -->
            </div>  <!-- </div> -->
            <div class="form-group">  <!-- <div class="form-group"> -->
                <label>Condition</label>  <!-- <label>Condition</label> -->
                <div style="display: flex; gap: 1rem;">  <!-- <div style="display: flex; gap: 1rem;"> -->
                    <select name="comparison" style="width: 100px;">  <!-- <select name="comparison" style="width: 100px;"> -->
                        <option value=">">Greater than</option>  <!-- <option value=">">Greater than</option> -->
                        <option value="<">Less than</option>  <!-- <option value="<">Less than</option> -->
                        <option value=">=">Greater/Equal</option>  <!-- <option value=">=">Greater/Equal</option> -->
                        <option value="<=">Less/Equal</option>  <!-- <option value="<=">Less/Equal</option> -->
                    </select>  <!-- </select> -->
                    <input type="number" name="threshold" required placeholder="Value" step="0.1">  <!-- <input type="number" name="threshold" required placeholder="Value" step="0.1"> -->
                </div>  <!-- </div> -->
            </div>  <!-- </div> -->
            <div class="form-group">  <!-- <div class="form-group"> -->
                <label>Server</label>  <!-- <label>Server</label> -->
                <select name="server_id">  <!-- <select name="server_id"> -->
                    <option value="">All Servers</option>  <!-- <option value="">All Servers</option> -->
                    <!-- Populated by JS -->  <!-- <!-- Populated by JS --> -->
                </select>  <!-- </select> -->
            </div>  <!-- </div> -->
            <div class="form-group">  <!-- <div class="form-group"> -->
                <label>Notifications</label>  <!-- <label>Notifications</label> -->
                <div class="checkbox-group">  <!-- <div class="checkbox-group"> -->
                    <label><input type="checkbox" name="notify_email" checked> Email</label>  <!-- <label><input type="checkbox" name="notify_email" checked> Email</label> -->
                    <label><input type="checkbox" name="notify_sms"> SMS</label>  <!-- <label><input type="checkbox" name="notify_sms"> SMS</label> -->
                    <label><input type="checkbox" name="notify_slack"> Slack</label>  <!-- <label><input type="checkbox" name="notify_slack"> Slack</label> -->
                </div>  <!-- </div> -->
            </div>  <!-- </div> -->
            <button type="submit" class="btn-primary" style="width: 100%;">Create Rule</button>  <!-- <button type="submit" class="btn-primary" style="width: 100%;">Create Rule</button> -->
        </form>  <!-- </form> -->
    </div>  <!-- </div> -->
</div>  <!-- </div> -->
  <!-- blank line -->
<style>  <!-- <style> -->
    .modal {  <!-- .modal { -->
        display: none;  <!-- display: none; -->
        position: fixed;  <!-- position: fixed; -->
        z-index: 1000;  <!-- z-index: 1000; -->
        left: 0;  <!-- left: 0; -->
        top: 0;  <!-- top: 0; -->
        width: 100%;  <!-- width: 100%; -->
        height: 100%;  <!-- height: 100%; -->
        background-color: rgba(0, 0, 0, 0.5);  <!-- background-color: rgba(0, 0, 0, 0.5); -->
        backdrop-filter: blur(5px);  <!-- backdrop-filter: blur(5px); -->
    }  <!-- } -->
  <!-- blank line -->
    .modal-content {  <!-- .modal-content { -->
        background-color: var(--bg-secondary);  <!-- background-color: var(--bg-secondary); -->
        margin: 10% auto;  <!-- margin: 10% auto; -->
        padding: 2rem;  <!-- padding: 2rem; -->
        border: 1px solid rgba(255, 255, 255, 0.1);  <!-- border: 1px solid rgba(255, 255, 255, 0.1); -->
        border-radius: 1rem;  <!-- border-radius: 1rem; -->
        width: 90%;  <!-- width: 90%; -->
        max-width: 500px;  <!-- max-width: 500px; -->
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);  <!-- box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); -->
    }  <!-- } -->
  <!-- blank line -->
    .close {  <!-- .close { -->
        color: var(--text-secondary);  <!-- color: var(--text-secondary); -->
        float: right;  <!-- float: right; -->
        font-size: 28px;  <!-- font-size: 28px; -->
        font-weight: bold;  <!-- font-weight: bold; -->
        cursor: pointer;  <!-- cursor: pointer; -->
    }  <!-- } -->
  <!-- blank line -->
    .close:hover {  <!-- .close:hover { -->
        color: var(--text-primary);  <!-- color: var(--text-primary); -->
    }  <!-- } -->
  <!-- blank line -->
    .form-group {  <!-- .form-group { -->
        margin-bottom: 1.5rem;  <!-- margin-bottom: 1.5rem; -->
    }  <!-- } -->
  <!-- blank line -->
    .form-group label {  <!-- .form-group label { -->
        display: block;  <!-- display: block; -->
        margin-bottom: 0.5rem;  <!-- margin-bottom: 0.5rem; -->
        color: var(--text-secondary);  <!-- color: var(--text-secondary); -->
    }  <!-- } -->
  <!-- blank line -->
    .form-group input,  <!-- .form-group input, -->
    .form-group select {  <!-- .form-group select { -->
        width: 100%;  <!-- width: 100%; -->
        padding: 0.75rem;  <!-- padding: 0.75rem; -->
        border-radius: 0.5rem;  <!-- border-radius: 0.5rem; -->
        background: rgba(255, 255, 255, 0.05);  <!-- background: rgba(255, 255, 255, 0.05); -->
        border: 1px solid rgba(255, 255, 255, 0.1);  <!-- border: 1px solid rgba(255, 255, 255, 0.1); -->
        color: var(--text-primary);  <!-- color: var(--text-primary); -->
    }  <!-- } -->
  <!-- blank line -->
    .checkbox-group {  <!-- .checkbox-group { -->
        display: flex;  <!-- display: flex; -->
        gap: 1rem;  <!-- gap: 1rem; -->
    }  <!-- } -->
  <!-- blank line -->
    .checkbox-group label {  <!-- .checkbox-group label { -->
        display: flex;  <!-- display: flex; -->
        align-items: center;  <!-- align-items: center; -->
        gap: 0.5rem;  <!-- gap: 0.5rem; -->
        cursor: pointer;  <!-- cursor: pointer; -->
    }  <!-- } -->
  <!-- blank line -->
    .checkbox-group input {  <!-- .checkbox-group input { -->
        width: auto;  <!-- width: auto; -->
    }  <!-- } -->
</style>  <!-- </style> -->
  <!-- blank line -->
<script>  <!-- <script> -->
    async function loadAlertRules() {  <!-- async function loadAlertRules() { -->
        try {  <!-- try { -->
            const response = await fetch('/api/alerts/rules');  <!-- const response = await fetch('/api/alerts/rules'); -->
            const data = await response.json();  <!-- const data = await response.json(); -->
            const tbody = document.getElementById('alertRulesBody');  <!-- const tbody = document.getElementById('alertRulesBody'); -->
            tbody.innerHTML = '';  <!-- tbody.innerHTML = ''; -->
  <!-- blank line -->
            if (data.rules.length === 0) {  <!-- if (data.rules.length === 0) { -->
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">No alert rules defined</td></tr>';  <!-- tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">No alert rules defined</td></tr>'; -->
                return;  <!-- return; -->
            }  <!-- } -->
  <!-- blank line -->
            data.rules.forEach(rule => {  <!-- data.rules.forEach(rule => { -->
                const row = document.createElement('tr');  <!-- const row = document.createElement('tr'); -->
                row.innerHTML = `  <!-- row.innerHTML = ` -->
                <td>${rule.name}</td>  <!-- <td>${rule.name}</td> -->
                <td>${rule.metric_type}</td>  <!-- <td>${rule.metric_type}</td> -->
                <td>${rule.comparison} ${rule.threshold}</td>  <!-- <td>${rule.comparison} ${rule.threshold}</td> -->
                <td>${rule.server_id || 'All'}</td>  <!-- <td>${rule.server_id || 'All'}</td> -->
                <td>${rule.is_active ? '<span style="color: var(--success-color)">Active</span>' : '<span style="color: var(--text-secondary)">Inactive</span>'}</td>  <!-- <td>${rule.is_active ? '<span style="color: var(--success-color)">Active</span>' : '<span style="color: var(--text-secondary)">Inactive</span>'}</td> -->
                <td>  <!-- <td> -->
                    <button class="btn btn-secondary btn-sm" onclick="toggleAlert(${rule.id}, ${!rule.is_active})">  <!-- <button class="btn btn-secondary btn-sm" onclick="toggleAlert(${rule.id}, ${!rule.is_active})"> -->
                        ${rule.is_active ? 'Disable' : 'Enable'}  <!-- ${rule.is_active ? 'Disable' : 'Enable'} -->
                    </button>  <!-- </button> -->
                    <button class="btn btn-danger btn-sm" onclick="deleteAlert(${rule.id})">Delete</button>  <!-- <button class="btn btn-danger btn-sm" onclick="deleteAlert(${rule.id})">Delete</button> -->
                </td>  <!-- </td> -->
            `;  <!-- `; -->
                tbody.appendChild(row);  <!-- tbody.appendChild(row); -->
            });  <!-- }); -->
        } catch (e) {  <!-- } catch (e) { -->
            console.error('Error loading rules:', e);  <!-- console.error('Error loading rules:', e); -->
        }  <!-- } -->
    }  <!-- } -->
  <!-- blank line -->
    async function loadAlertHistory() {  <!-- async function loadAlertHistory() { -->
        try {  <!-- try { -->
            const response = await fetch('/api/alerts/history');  <!-- const response = await fetch('/api/alerts/history'); -->
            const data = await response.json();  <!-- const data = await response.json(); -->
            const container = document.getElementById('alertHistory');  <!-- const container = document.getElementById('alertHistory'); -->
  <!-- blank line -->
            if (data.history.length === 0) {  <!-- if (data.history.length === 0) { -->
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No alerts triggered yet</p>';  <!-- container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No alerts triggered yet</p>'; -->
                return;  <!-- return; -->
            }  <!-- } -->
  <!-- blank line -->
            container.innerHTML = data.history.map(h => `  <!-- container.innerHTML = data.history.map(h => ` -->
            <div style="padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 3px solid var(--error-color);">  <!-- <div style="padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 3px solid var(--error-color);"> -->
                <div style="display: flex; justify-content: space-between;">  <!-- <div style="display: flex; justify-content: space-between;"> -->
                    <strong>${h.rule_name}</strong>  <!-- <strong>${h.rule_name}</strong> -->
                    <span style="color: var(--text-secondary); font-size: 0.875rem;">${new Date(h.triggered_at).toLocaleString()}</span>  <!-- <span style="color: var(--text-secondary); font-size: 0.875rem;">${new Date(h.triggered_at).toLocaleString()}</span> -->
                </div>  <!-- </div> -->
                <div style="color: var(--text-secondary); margin-top: 0.25rem;">${h.message}</div>  <!-- <div style="color: var(--text-secondary); margin-top: 0.25rem;">${h.message}</div> -->
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">Server: ${h.server_name}</div>  <!-- <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">Server: ${h.server_name}</div> -->
            </div>  <!-- </div> -->
        `).join('');  <!-- `).join(''); -->
        } catch (e) {  <!-- } catch (e) { -->
            console.error('Error loading history:', e);  <!-- console.error('Error loading history:', e); -->
        }  <!-- } -->
    }  <!-- } -->
  <!-- blank line -->
    function showCreateAlert() {  <!-- function showCreateAlert() { -->
        document.getElementById('createAlertModal').style.display = 'block';  <!-- document.getElementById('createAlertModal').style.display = 'block'; -->
        // Load servers for dropdown  <!-- // Load servers for dropdown -->
        fetch('/api/servers').then(r => r.json()).then(data => {  <!-- fetch('/api/servers').then(r => r.json()).then(data => { -->
            const select = document.querySelector('select[name="server_id"]');  <!-- const select = document.querySelector('select[name="server_id"]'); -->
            select.innerHTML = '<option value="">All Servers</option>';  <!-- select.innerHTML = '<option value="">All Servers</option>'; -->
            data.servers.forEach(s => {  <!-- data.servers.forEach(s => { -->
                select.innerHTML += `<option value="${s.id}">${s.name}</option>`;  <!-- select.innerHTML += `<option value="${s.id}">${s.name}</option>`; -->
            });  <!-- }); -->
        });  <!-- }); -->
    }  <!-- } -->
  <!-- blank line -->
    function closeCreateAlert() {  <!-- function closeCreateAlert() { -->
        document.getElementById('createAlertModal').style.display = 'none';  <!-- document.getElementById('createAlertModal').style.display = 'none'; -->
    }  <!-- } -->
  <!-- blank line -->
    async function createAlert(e) {  <!-- async function createAlert(e) { -->
        e.preventDefault();  <!-- e.preventDefault(); -->
        const formData = new FormData(e.target);  <!-- const formData = new FormData(e.target); -->
        const data = Object.fromEntries(formData.entries());  <!-- const data = Object.fromEntries(formData.entries()); -->
  <!-- blank line -->
        // Handle checkboxes  <!-- // Handle checkboxes -->
        data.notify_email = formData.get('notify_email') === 'on';  <!-- data.notify_email = formData.get('notify_email') === 'on'; -->
        data.notify_sms = formData.get('notify_sms') === 'on';  <!-- data.notify_sms = formData.get('notify_sms') === 'on'; -->
        data.notify_slack = formData.get('notify_slack') === 'on';  <!-- data.notify_slack = formData.get('notify_slack') === 'on'; -->
  <!-- blank line -->
        // Handle empty server_id  <!-- // Handle empty server_id -->
        if (!data.server_id) delete data.server_id;  <!-- if (!data.server_id) delete data.server_id; -->
  <!-- blank line -->
        try {  <!-- try { -->
            const response = await fetch('/api/alerts/rules', {  <!-- const response = await fetch('/api/alerts/rules', { -->
                method: 'POST',  <!-- method: 'POST', -->
                headers: { 'Content-Type': 'application/json' },  <!-- headers: { 'Content-Type': 'application/json' }, -->
                body: JSON.stringify(data)  <!-- body: JSON.stringify(data) -->
            });  <!-- }); -->
  <!-- blank line -->
            if (response.ok) {  <!-- if (response.ok) { -->
                closeCreateAlert();  <!-- closeCreateAlert(); -->
                e.target.reset();  <!-- e.target.reset(); -->
                loadAlertRules();  <!-- loadAlertRules(); -->
            } else {  <!-- } else { -->
                alert('Failed to create alert rule');  <!-- alert('Failed to create alert rule'); -->
            }  <!-- } -->
        } catch (error) {  <!-- } catch (error) { -->
            console.error('Error creating alert:', error);  <!-- console.error('Error creating alert:', error); -->
            alert('Error creating alert rule');  <!-- alert('Error creating alert rule'); -->
        }  <!-- } -->
    }  <!-- } -->
  <!-- blank line -->
    async function toggleAlert(id, active) {  <!-- async function toggleAlert(id, active) { -->
        await fetch(`/api/alerts/rules/${id}`, {  <!-- await fetch(`/api/alerts/rules/${id}`, { -->
            method: 'PUT',  <!-- method: 'PUT', -->
            headers: { 'Content-Type': 'application/json' },  <!-- headers: { 'Content-Type': 'application/json' }, -->
            body: JSON.stringify({ is_active: active })  <!-- body: JSON.stringify({ is_active: active }) -->
        });  <!-- }); -->
        loadAlertRules();  <!-- loadAlertRules(); -->
    }  <!-- } -->
  <!-- blank line -->
    async function deleteAlert(id) {  <!-- async function deleteAlert(id) { -->
        if (!confirm('Delete this alert rule?')) return;  <!-- if (!confirm('Delete this alert rule?')) return; -->
        await fetch(`/api/alerts/rules/${id}`, { method: 'DELETE' });  <!-- await fetch(`/api/alerts/rules/${id}`, { method: 'DELETE' }); -->
        loadAlertRules();  <!-- loadAlertRules(); -->
    }  <!-- } -->
  <!-- blank line -->
    // Close modal when clicking outside  <!-- // Close modal when clicking outside -->
    window.onclick = function (event) {  <!-- window.onclick = function (event) { -->
        const modal = document.getElementById('createAlertModal');  <!-- const modal = document.getElementById('createAlertModal'); -->
        if (event.target == modal) {  <!-- if (event.target == modal) { -->
            closeCreateAlert();  <!-- closeCreateAlert(); -->
        }  <!-- } -->
    }  <!-- } -->
  <!-- blank line -->
    loadAlertRules();  <!-- loadAlertRules(); -->
    loadAlertHistory();  <!-- loadAlertHistory(); -->
    setInterval(() => { loadAlertRules(); loadAlertHistory(); }, 30000);  <!-- setInterval(() => { loadAlertRules(); loadAlertHistory(); }, 30000); -->
</script>  <!-- </script> -->
{% endblock %}  <!-- {% endblock %} -->
